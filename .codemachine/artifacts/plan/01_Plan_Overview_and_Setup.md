<!-- anchor: project-plan -->
# Project Plan: HOA Management System Extension Roadmap

**Version:** 1.0  
**Date:** 2025-11-23  
**Generated By:** Codex (GPT-5)

<!-- anchor: project-overview -->
## 1. Project Overview

*   **Goal:** Deliver a medium-scale extension of the existing HOA Management System that strengthens board governance transparency, launches an Accessibility Suite, introduces the hash-chained Democracy module, curates a Vendor Directory, and hardens CI/CD without exceeding the 1GB Linode budget.
*   **High-Level Requirements Summary:**
    *   Board roster + history management with role visibility toggles, authenticated history access, and SendGrid-powered contact workflow.
    *   Accessibility Suite with high-contrast theming, contextual helpers, global toggle, and persisted preferences.
    *   Democracy module enabling informal/binding polls, optional member notifications, cryptographic hash chaining, and receipt verification flows.
    *   Vendor Directory with curated schema, admin moderation tools, and filtered guest/member views.
    *   CI/CD enhancements adding npm audit gating plus dockerized health probes before GHCR pushes.
*   **Key Assumptions:** Existing React + Node/Express + SQLite stack remains; SendGrid account, CAPTCHA helper, and session/JWT auth already function; a single Dockerized deployment serves SPA + API; no additional managed services or queues allowed; residents primarily use English; feature flags via Config table gate every new UI surface; volunteers can execute migrations and manual rollouts with documented runbooks.

<!-- anchor: core-architecture -->
## 2. Core Architecture

*   **Architectural Style:** Opinionated layered monolith (React SPA + Node.js/Express backend) with strict module boundaries and SQLite persistence.
*   **Technology Stack:**
    *   Frontend: React 18 + Vite + TypeScript + Material UI, React Query, React Hook Form, custom AccessibilityContext + Theme Engine.
    *   Backend: Node.js 18 LTS, Express controllers, service/repository pattern, pino logging, zod validation.
    *   Database: SQLite 3 with migration scripts, covering Board/Config/Poll/Vendor schemas and hash-chain friendly indexes.
    *   Messaging/Queues: None; synchronous SendGrid dispatch via EmailNotificationService with retry/backoff.
    *   Deployment: Docker image published to GHCR and deployed on Linode Nanode via docker-compose; GitHub Actions orchestrates CI/CD.
    *   Other Key Libraries/Tools: SendGrid SDK, crypto (SHA256), Jest/React Testing Library, axe-core, GitHub Actions workflows, FeatureFlagAdmin UI, captcha verifier.
*   **Key Components/Services:** CommunityWebApp SPA, AdminConsole surfaces, ApiGateway (Express), BoardGovernanceService, DemocracyService + VoteIntegrityEngine, AccessibilityContextService + ThemeEngine, VendorDirectoryService, ConfigRegistry cache, EmailNotificationService, ResidentNotificationLog adapter, CI/CD workflows. Component and sequence diagrams planned for Iterations I1–I3.
*   **Data Model Overview:** Entities include BoardTitles, BoardMembers, ConfigFlag/FeatureFlagAudit, ContactRequest, Polls/PollOptions/Votes with prev_hash + vote_hash, Vendors, AccessibilityPreference, EmailAudit/ResidentNotificationLog, AuditEvent. ERD artifact refined in Iteration I1 to align schema/migration scope.
*   **API Contract Style:** RESTful JSON documented via OpenAPI v3 (YAML). Initial spec updates targeted in I1 (board/polls) and I3 (vendor/poll receipts) to guide autonomous agents.
*   **Communication Patterns:** HTTPS SPA→API calls via React Query; backend controllers call services + repositories; SendGrid integration synchronous; SQLite transactions enforce hash-chain ordering; feature flag fetches propagate TTL metadata. Sequence diagrams (Iteration I2) clarify voting + accessibility flows.

<!-- anchor: key-artifacts -->
## 2.1. Key Architectural Artifacts Planned

*   Component Diagram (PlantUML) – Depicts Board, Democracy, Accessibility, Vendor modules plus ConfigRegistry interactions (Created/updated in I1.T2 to inform backend/front-end division of labor).
*   Database ERD (Mermaid) – Documents Board, Poll, Vendor, Config, Audit entities and relationships for migration planning (Produced in I1.T3).
*   OpenAPI Specification Updates (YAML) – Covers `/board`, `/polls`, `/vendors`, `/config`, `/healthz`; split across I1.T4, I3.T2, and I4.T2 for progressive coverage.
*   Accessibility Theme Token Spec (Markdown + JSON) – Enumerates typography, color, spacing tokens for standard vs high-vis modes (Generated in I2.T2).
*   Democracy Hash Chain Sequence Diagram (PlantUML) – Shows vote submission, hash computation, receipt verification steps (Created in I3.T3).
*   Vendor Moderation Flowchart (Mermaid) – Visualizes submission→approval pipeline guiding admin UI (Produced in I4.T1).
*   CI/CD Workflow Diagram (Mermaid) – Illustrates npm audit + docker health gate sequence for GitHub Actions (Created in I5.T2).

<!-- anchor: directory-structure -->
## 3. Directory Structure

*   **Root Directory:** `hoa-management-system/`
*   **Structure Definition:**
    ~~~
    hoa-management-system/
    ├── backend/
    │   ├── src/
    │   │   ├── controllers/         # board.controller.js, poll.controller.js, vendor.controller.js
    │   │   ├── services/            # boardGovernance, democracy, vendorDirectory, emailNotification, configRegistry
    │   │   ├── models/              # sequelize/knex or raw SQL helpers + new vendor model
    │   │   ├── routes/              # board.routes.js, poll.routes.js, vendor.routes.js
    │   │   ├── middlewares/         # authGuard, rateLimiter, captcha validation
    │   │   └── utils/               # vote hash helper, feature flag helpers
    │   ├── migrations/              # SQL migration files for Board, Polls, Vendors, Accessibility preferences
    │   ├── seeds/                   # default board titles, config flags, theme presets
    │   └── tests/                   # Jest specs for controllers/services
    ├── frontend/
    │   ├── src/
    │   │   ├── pages/               # Board.tsx, Polls.tsx, PollDetail.tsx, Vendors.tsx, admin views
    │   │   ├── components/
    │   │   │   ├── Accessibility/   # Toggle, context provider, helper components
    │   │   │   ├── Board/
    │   │   │   ├── Polls/
    │   │   │   ├── Vendors/
    │   │   │   └── common/
    │   │   ├── contexts/            # AccessibilityContext.tsx, FeatureFlagContext.tsx
    │   │   ├── api/                 # typed API clients consuming OpenAPI spec
    │   │   ├── theme/               # theme.ts, tokens.json
    │   │   └── tests/               # RTL tests for key components
    │   ├── public/
    │   └── vite.config.ts
    ├── api/
    │   └── openapi.yaml             # consolidated API contract with incremental updates
    ├── docs/
    │   ├── diagrams/
    │   │   ├── component-board-democracy.puml
    │   │   ├── democracy-sequence.puml
    │   │   └── vendor-flowchart.mmd
    │   ├── design/
    │   │   ├── accessibility-theme-tokens.md
    │   │   └── ui-copy-guidelines.md
    │   ├── adr/
    │   └── runbooks/                # deployment, backup, feature flag procedures
    ├── scripts/
    │   ├── migrate.sh
    │   ├── hash-chain-verify.js
    │   └── healthcheck.sh
    ├── .github/
    │   └── workflows/               # ci.yml, deploy.yml with npm audit + health gate enhancements
    ├── docker/
    │   └── Dockerfile               # multi-stage build bundling frontend + backend
    ├── docker-compose.yml
    ├── package.json
    ├── README.md
    ├── .env.example
    └── .codemachine/
        └── artifacts/
            └── plan/                # generated plan + manifest
    ~~~
    Key documentation, diagram, and API artifact folders are co-located under `docs/` and `api/` to keep source-controlled references accessible to autonomous agents and reviewers.
